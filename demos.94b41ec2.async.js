"use strict";(self.webpackChunk_koko_libs=self.webpackChunk_koko_libs||[]).push([[433],{42147:function(b,E,r){r.r(E),r.d(E,{default:function(){return V}});var L=r(67294),z=r(17061),M=r.n(z),G=r(17156),I=r.n(G),N=r(27424),K=r.n(N),R=r(71577),$=r(45360),H=r(57584),h=r.n(H),q=r(14074),_=r(65129),ee=r(10884),re=r(31568),l=r(85893),J=function(c){var o=16e3,j=16,x=1280;h().CLog=function(){};var S=function(){u=null},T,C,m,u,t,d,k=function g(s,p,P){if(u===null&&(T=0,C=0,m=null,u=[]),!(j===16&&x%2===1)){var i=[],f=0;if(s.length>0){t=h().SampleData(s,p,o,m);for(var y=m?m.index:0;y<t.index-3;y++)s[y]=null;if(m=t,i=t.data,f=t.sampleRate,f!==o)throw new Error("\u4E0D\u5E94\u8BE5\u51FA\u73B0pcm\u91C7\u6837\u7387"+f+"\u548C\u9700\u8981\u7684\u91C7\u6837\u7387"+o+"\u4E0D\u4E00\u81F4")}i.length>0&&u.push({pcm:i,pcmSampleRate:f});var U=x/(j/8);i=new Int16Array(U),f=0;var O=!1,Z=0;e:for(var B=0;B<u.length;B++){t=u[B],f=t.pcmSampleRate;for(var D=t.offset||0;D<t.pcm.length;D++)if(i[Z]=t.pcm[D],Z++,Z===U){O=!0,t.offset=D+1;for(var w=0;w<B;w++)u.splice(0,1);break e}}if(!O){P&&(d=++T,a(d,null,0,null,P));return}d=++T;var X=Date.now(),A=h()({type:"pcm",sampleRate:o,bitRate:j});A.mock(i,f),A.stop(function(F,Y){F.encTime=Date.now()-X,a(d,F,Y,A,!1),g([],0,P)},function(F){console.log("msg",F)})}},a=function(s,p,P,i,f){if(C=Math.max(C,s),p){var y=p,U=y.encTime;c(y,U)}},e;function n(){e&&e.close(),e=h()({type:"unknown",onProcess:function(s,p,P,i){k(s,i,!1)}}),e.open(function(){e.start(),S()})}function v(){e&&e.close(),k([],0,!0)}return{recStart:n,recStop:v}},Q=function(){var c=(0,L.useRef)(),o=(0,L.useRef)(null),j=(0,L.useState)(),x=K()(j,2),S=x[0],T=x[1],C=function(){var e=h()({type:"mp3",bitRate:16,sampleRate:16e3,onProcess:function(v,g,s,p){console.log(v,g,s,p)}});e.open(function(){console.log("newRec",e),c.current=e},function(n,v){console.log((v?"UserNotAllow\uFF0C":"")+"\u65E0\u6CD5\u5F55\u97F3:"+n)})},m=function(){c.current&&h().IsOpen()&&c.current.start()},u=function(){try{if(!c.current){console.error("\u672A\u6253\u5F00\u5F55\u97F3");return}c.current.stop(function(e,n){if(console.log("\u5F55\u97F3\u6210\u529F",e,"\u65F6\u957F:"+n+"ms"),e){var v=new FormData;v.append("audio",e),console.log("blob",e),T(e)}c.current.close(),o.current&&(o.current.src=URL.createObjectURL(e),o.current.play())})}catch(e){console.error("\u7ED3\u675F\u5F55\u97F3\u51FA\u9519\uFF1A"+e),c.current.close(),c.current=null}},t=function(e,n){console.log("blob",e,n),T(e)},d=(0,L.useMemo)(function(){return J(t)},[]),k=function(e){var n=document.createElement("a");n.download="\u9080\u8BF7\u4E8C\u7EF4\u7801.pcm",n.href=e,document.body.appendChild(n),n.click(),n.remove()};return(0,l.jsxs)("div",{children:[(0,l.jsx)(R.ZP,{onClick:C,children:"\u83B7\u53D6\u6743\u9650"}),(0,l.jsx)(R.ZP,{onClick:m,children:"\u5F00\u59CB\u5F55\u97F3"}),(0,l.jsx)(R.ZP,{onClick:u,children:"\u505C\u6B62\u5F55\u97F3"}),(0,l.jsx)(R.ZP,{onClick:function(){return d.recStart()},children:"pmc-start"}),(0,l.jsx)(R.ZP,{onClick:function(){return d.recStop()},children:"pmc-stop"}),(0,l.jsx)(R.ZP,{onClick:I()(M()().mark(function a(){return M()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:o.current&&S&&($.ZP.info("\u5F00\u59CB\u64AD\u653E"),console.log("recBlob",S),k(URL.createObjectURL(S)),o.current.src=URL.createObjectURL(S),o.current.play());case 1:case"end":return n.stop()}},a)})),children:"\u64AD\u653E"}),(0,l.jsx)("audio",{ref:o})]})},V=function(){return(0,l.jsx)(Q,{})}}}]);
